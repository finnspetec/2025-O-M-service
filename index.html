<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>日益智慧能源 - 2025年度維運服務滿意度調查</title>
    <!-- React & ReactDOM CDN -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel for JSX Compilation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; scroll-behavior: smooth; }
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        .float-animate { animation: float 4s ease-in-out infinite; }
        .loading-dots:after {
            content: '.';
            animation: dots 1.5s steps(5, end) infinite;
        }
        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60% { content: '...'; }
            80%, 100% { content: ''; }
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // SVG 圖示組件
        const SunIcon = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg>
        );

        const FactoryIcon = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M2 20a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8l-7 5V8l-7 5V4a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z"/><path d="M17 18h1"/><path d="M12 18h1"/><path d="M7 18h1"/></svg>
        );

        const UserIcon = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
        );

        const CheckIcon = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><path d="m9 12 2 2 4-4"/></svg>
        );

        const SendIcon = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m22 2-7 20-4-9-9-4Z"/><path d="M22 2 11 13"/></svg>
        );

        const App = () => {
            const [formData, setFormData] = useState({
                'entry.899999615': '', // 案場名稱
                'entry.464377799': [], // 填寫人
                'entry.1414352831': '', // 1.滿意度
                'entry.726589747': [], // 1-1 原因
                'entry.418035188': '', // 2.符合度
                'entry.842552003': [], // 2-1 原因
                'entry.2061844101': '', // 3.競爭力
                'entry.67805626': [], // 3-1 原因
                'entry.1003343879': '', // 4.巡檢
                'entry.1664860146': '', // 5.問題發現
                'entry.1578497332': '', // 6.回應速度
                'entry.553624540': '', // 7.故障排除
                'entry.1437601907': '', // 8.監控通知
                'entry.1343935114': '', // 9.報告理解
                'entry.2141434383': '', // 10.溝通
                'entry.2082616046': '', // 11.需求理解
                'entry.951165679': [], // 12.改善項目
                'entry.1748333818': '', // 13.改善空間
                'entry.1579464985': '', // 14.優化建議
                'entry.1045920345': ''  // 15.其他回饋
            });

            const [status, setStatus] = useState('idle'); // idle, submitting, submitted
            
            // 重要：Google 表單驗證數據
            const googleFormMeta = {
                action: "https://docs.google.com/forms/u/0/d/e/1FAIpQLScWKCVehF5x0dh4jXpC6pitzsvmOJSzUrGvWHh3hfuW332JNQ/formResponse",
                fbzx: "764606553543506960",
                pageHistory: "0",
                fvv: "1"
            };

            const handleInputChange = (e) => {
                const { name, value } = e.target;
                setFormData(prev => ({ ...prev, [name]: value }));
            };

            const handleCheckboxChange = (name, value) => {
                setFormData(prev => {
                    const current = prev[name];
                    if (current.includes(value)) {
                        return { ...prev, [name]: current.filter(item => item !== value) };
                    } else {
                        return { ...prev, [name]: [...current, value] };
                    }
                });
            };

            const handleSubmit = () => {
                setStatus('submitting');
                // 延長時間確保資料封包完整發出
                setTimeout(() => {
                    setStatus('submitted');
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }, 2500);
            };

            const scoreOptions = ["1.非常不滿意", "2.不滿意", "3.尚可", "4.滿意", "5.非常滿意"];

            const renderRadioGroup = (name, label, options) => (
                <div className="mb-8 p-6 bg-white/80 backdrop-blur-sm rounded-2xl shadow-sm border border-sky-100 transition-all hover:shadow-md">
                    <label className="block text-slate-700 font-bold mb-4 text-lg">
                        {label} <span className="text-rose-500">*</span>
                    </label>
                    <div className="grid grid-cols-1 md:grid-cols-5 gap-3">
                        {options.map((option) => (
                            <button
                                key={option}
                                type="button"
                                onClick={() => setFormData(prev => ({ ...prev, [name]: option }))}
                                className={`px-4 py-3 rounded-xl border-2 transition-all text-sm font-medium ${
                                    formData[name] === option 
                                        ? 'border-sky-500 bg-sky-500 text-white shadow-lg shadow-sky-200' 
                                        : 'border-slate-100 bg-white text-slate-600 hover:border-sky-300'
                                }`}
                            >
                                {option}
                            </button>
                        ))}
                    </div>
                    {/* 真實提交用的隱藏 Input */}
                    <input type="hidden" name={name} value={formData[name]} />
                </div>
            );

            const renderCheckboxGroup = (name, label, options) => (
                <div className="mb-8 p-6 bg-white/80 backdrop-blur-sm rounded-2xl shadow-sm border border-sky-100 transition-all hover:shadow-md">
                    <label className="block text-slate-700 font-bold mb-4 text-lg">
                        {label}
                    </label>
                    <div className="flex flex-wrap gap-3">
                        {options.map((option) => (
                            <button
                                key={option}
                                type="button"
                                onClick={() => handleCheckboxChange(name, option)}
                                className={`px-4 py-2 rounded-full border-2 transition-all text-sm font-medium ${
                                    formData[name].includes(option)
                                        ? 'border-amber-500 bg-amber-500 text-white shadow-lg shadow-amber-100'
                                        : 'border-slate-100 bg-white text-slate-600 hover:border-amber-300'
                                }`}
                            >
                                {option}
                            </button>
                        ))}
                    </div>
                    {/* 重要：Google Forms 接收多選需要重複 name 的隱藏欄位 */}
                    {formData[name].map((val, idx) => (
                        <input key={`${name}-${idx}`} type="hidden" name={name} value={val} />
                    ))}
                </div>
            );

            if (status === 'submitted') {
                return (
                    <div className="min-h-screen bg-sky-50 flex items-center justify-center p-4">
                        <div className="bg-white p-10 rounded-3xl shadow-2xl text-center max-w-md w-full border-t-8 border-sky-500 relative z-10">
                            <div className="bg-green-100 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6">
                                <CheckIcon className="text-green-500 w-12 h-12" />
                            </div>
                            <h2 className="text-3xl font-black text-slate-800 mb-4">提交成功！</h2>
                            <p className="text-slate-600 leading-relaxed mb-8">
                                感謝您撥冗填寫本次問卷。<br/>您的寶貴回饋已順利傳送至後台回覆。
                            </p>
                            <button onClick={() => window.location.reload()} className="w-full bg-sky-500 text-white py-3 rounded-xl font-bold hover:bg-sky-600 transition-colors">
                                返回重新填寫
                            </button>
                        </div>
                    </div>
                );
            }

            return (
                <div className={`min-h-screen pb-20 ${status === 'submitting' ? 'opacity-70 cursor-wait' : ''}`}>
                    <header className="relative h-80 flex items-center justify-center overflow-hidden">
                        <img 
                            src="https://images.unsplash.com/photo-1509391366360-2e959784a276?q=80&w=2070&auto=format&fit=crop" 
                            className="absolute inset-0 w-full h-full object-cover"
                            alt="Solar Panel"
                        />
                        <div className="absolute inset-0 bg-gradient-to-b from-sky-600/40 to-slate-50"></div>
                        <div className="relative z-10 text-center px-4">
                            <h1 className="text-white text-4xl md:text-5xl font-black drop-shadow-lg mb-2 tracking-widest">日益智慧能源</h1>
                            <p className="text-sky-50 text-xl md:text-2xl font-medium drop-shadow-md">2025年度維運服務滿意度調查</p>
                        </div>
                    </header>

                    <main className="max-w-4xl mx-auto -mt-16 relative z-10 px-4">
                        <div className="bg-white/90 backdrop-blur-md p-8 rounded-3xl shadow-xl border border-white mb-8">
                            <p className="text-slate-600 text-lg leading-relaxed text-center font-medium">
                                本問卷目的在於了解貴公司對本案場維運服務之整體感受，作為我們持續優化服務品質之依據。<br className="hidden md:block" />
                                敬請依實際經驗填寫，感謝您的協助。
                            </p>
                        </div>

                        {/* 關鍵：用來攔截 Google 的 iframe */}
                        <iframe name="hidden_confirm" id="hidden_confirm" style={{display: 'none'}}></iframe>

                        <form 
                            action={googleFormMeta.action} 
                            method="POST" 
                            target="hidden_confirm"
                            onSubmit={handleSubmit}
                        >
                            {/* 校驗用元數據 */}
                            <input type="hidden" name="fbzx" value={googleFormMeta.fbzx} />
                            <input type="hidden" name="pageHistory" value={googleFormMeta.pageHistory} />
                            <input type="hidden" name="fvv" value={googleFormMeta.fvv} />

                            {/* 1. 案場名稱 */}
                            <div className="p-6 bg-white/80 backdrop-blur-sm rounded-2xl shadow-sm border border-sky-100 mb-6 transition-all hover:shadow-md">
                                <div className="flex items-center gap-3 mb-4">
                                    <FactoryIcon className="text-sky-500" />
                                    <label className="text-slate-700 font-bold text-lg">案場名稱 <span className="text-rose-500">*</span></label>
                                </div>
                                <input 
                                    required 
                                    type="text" 
                                    name="entry.899999615" 
                                    placeholder="請輸入完整的案場名稱" 
                                    className="w-full p-4 rounded-xl border-2 border-slate-100 focus:border-sky-500 focus:outline-none transition-all"
                                    value={formData['entry.899999615']}
                                    onChange={handleInputChange}
                                />
                            </div>

                            {/* 2. 填寫人 */}
                            <div className="p-6 bg-white/80 backdrop-blur-sm rounded-2xl shadow-sm border border-sky-100 mb-6 transition-all hover:shadow-md">
                                <div className="flex items-center gap-3 mb-4">
                                    <UserIcon className="text-sky-500" />
                                    <label className="text-slate-700 font-bold text-lg">填寫人 (可複選) <span className="text-rose-500">*</span></label>
                                </div>
                                <div className="flex flex-wrap gap-3">
                                    {["公司負責人", "維運承辦人", "專案負責人"].map(role => (
                                        <button 
                                            key={role} type="button"
                                            onClick={() => handleCheckboxChange('entry.464377799', role)}
                                            className={`px-6 py-3 rounded-xl border-2 transition-all font-medium ${formData['entry.464377799'].includes(role) ? 'bg-sky-500 border-sky-500 text-white shadow-md' : 'bg-white border-slate-100 text-slate-600 hover:border-sky-300'}`}
                                        >
                                            {role}
                                        </button>
                                    ))}
                                </div>
                                {formData['entry.464377799'].map((val, idx) => <input key={`role-${idx}`} type="hidden" name="entry.464377799" value={val} />)}
                            </div>

                            {/* 評分區塊 */}
                            <div className="pt-10 mb-6 border-b-2 border-slate-200 pb-2 flex items-center gap-2">
                                <h3 className="text-2xl font-black text-slate-800">服務滿意度評分</h3>
                            </div>

                            {renderRadioGroup('entry.1414352831', '1. 整體而言，您對本案場目前的維運服務滿意程度為何？', scoreOptions)}
                            {(formData['entry.1414352831'] && !formData['entry.1414352831'].includes('4') && !formData['entry.1414352831'].includes('5')) && 
                                renderCheckboxGroup('entry.726589747', '1-1. 請簡要說明目前較不符合期待的主要原因：', ["回應速度偏慢", "問題處理不夠即時", "技術說明或溝通不夠清楚", "巡檢或保養品質待加強", "故障排除效率不足", "與內部需求配合度不足"])}

                            {renderRadioGroup('entry.418035188', '2. 較您的期待，本公司的維運服務表現符合程度為何？', scoreOptions)}
                            {(formData['entry.418035188'] && !formData['entry.418035188'].includes('4') && !formData['entry.418035188'].includes('5')) && 
                                renderCheckboxGroup('entry.842552003', '2-1. 您認為與原先期待落差較大的部分為何：', ["回應速度", "技術專業度", "服務內容深度", "溝通與說明方式", "整體資源投入"])}

                            {renderRadioGroup('entry.2061844101', '3. 若以同類型服務比較，您認為本公司的維運品質競爭力為何？', ["1.非常沒有競爭力", "2.沒有競爭力", "3.尚可", "4.有競爭力", "5.非常有競爭力"])}
                            {(formData['entry.2061844101'] && !formData['entry.2061844101'].includes('4') && !formData['entry.2061844101'].includes('5')) && 
                                renderCheckboxGroup('entry.67805626', '3-1. 與其他服務商相比，您認為本公司較需要加強的面向：', ["價值感受與費用對應", "回應效率", "技術能力", "主動性與改善建議", "溝通協調"])}

                            <div className="pt-10 mb-6 border-b-2 border-slate-200 pb-2">
                                <h3 className="text-2xl font-black text-slate-800">維運執行細項評估</h3>
                            </div>

                            {renderRadioGroup('entry.1003343879', '4. 定期巡檢與保養執行的確實程度', ["1.非常沒有確實", "2.沒有確實", "3.尚可", "4.有確實", "5.非常有確實"])}
                            {renderRadioGroup('entry.1664860146', '5. 問題發現與回報的即時性', ["1.非常不即時", "2.沒有即時", "3.尚可", "4.有即時", "5.非常即時"])}
                            {renderRadioGroup('entry.1578497332', '6. 異常事件的回應速度', ["1.非常不即時", "2.沒有即時", "3.尚可", "4.有即時", "5.非常即時"])}
                            {renderRadioGroup('entry.553624540', '7. 故障排除的專業度與完整性', ["1.非常不專業、不完整", "2.不專業、不完整", "3.尚可", "4.有專業、完整", "5.非常專業、完整"])}
                            {renderRadioGroup('entry.1437601907', '8. 發電監控與異常通知的清楚程度', ["1.非常不清楚", "2.不清楚", "3.尚可", "4.有清楚", "5.非常清楚"])}
                            {renderRadioGroup('entry.1343935114', '9. 維運相關報告或說明的理解性', ["1.非常不好理解", "2.不好理解", "3.尚可", "4.能理解", "5.非常能理解"])}
                            {renderRadioGroup('entry.2141434383', '10. 維運窗口的溝通順暢度', ["1.非常不順暢", "2.不順暢", "3.尚可", "4.很順暢", "5.非常順暢"])}
                            {renderRadioGroup('entry.2082616046', '11. 對客戶需求與現場狀況的理解程度', ["1.非常不理解", "2.不理解", "3.尚可", "4.能理解", "5.非常能理解"])}

                            {renderCheckboxGroup('entry.951165679', '12. 您認為目前最需要優先改善的項目為：', ["1.回應速度", "2.技術說明", "3.巡檢品質", "4.溝通方式"])}
                            {renderRadioGroup('entry.1748333818', '13. 整體而言，您認為目前維運服務是否仍有明顯改善空間？', ["1.幾乎沒有", "2.少量", "3.中等", "4.明顯"])}

                            {/* 簡答題 - 確保 Name 正確 */}
                            <div className="p-6 bg-white/80 backdrop-blur-sm rounded-2xl shadow-sm border border-sky-100 mb-6">
                                <label className="block text-slate-700 font-bold mb-4 text-lg">14. 若未來可調整部分服務內容，您最希望優化的是？ <span className="text-rose-500">*</span></label>
                                <textarea required name="entry.1579464985" rows="4" placeholder="請輸入您的建議..." className="w-full p-4 rounded-xl border-2 border-slate-100 focus:border-sky-500 focus:outline-none transition-all" value={formData['entry.1579464985']} onChange={handleInputChange}></textarea>
                            </div>

                            <div className="p-6 bg-white/80 backdrop-blur-sm rounded-2xl shadow-sm border border-sky-100 mb-6">
                                <label className="block text-slate-700 font-bold mb-4 text-lg">15. 其他您願意提供的建議或回饋 <span className="text-rose-500">*</span></label>
                                <textarea required name="entry.1045920345" rows="4" placeholder="任何想對我們說的話..." className="w-full p-4 rounded-xl border-2 border-slate-100 focus:border-sky-500 focus:outline-none transition-all" value={formData['entry.1045920345']} onChange={handleInputChange}></textarea>
                            </div>

                            <div className="py-10">
                                <button 
                                    type="submit" 
                                    className={`w-full bg-gradient-to-r from-sky-500 to-sky-600 text-white py-5 rounded-2xl font-black text-xl shadow-xl shadow-sky-200 hover:scale-[1.02] active:scale-[0.98] transition-all flex items-center justify-center gap-3 ${status === 'submitting' ? 'animate-pulse cursor-wait' : ''}`}
                                >
                                    {status === 'submitting' ? (
                                        <span className="loading-dots">傳送中，請稍候</span>
                                    ) : (
                                        <><SendIcon className="w-6 h-6" /> 提交問卷</>
                                    )}
                                </button>
                                <p className="text-center text-slate-400 text-sm mt-4">日益智慧能源股份有限公司 - 2025 年度維運服務問卷調查</p>
                            </div>
                        </form>
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
